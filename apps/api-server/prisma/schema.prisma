generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum PublishStatus {
  draft
  published
  archived
}

model User {
  id           Int       @id @default(autoincrement())
  email        String    @unique
  passwordHash String
  name         String
  photoUrl     String?
  role         String    @default("admin")
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  sessions     Session[]
}

model Role {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String   @default("")
  permissions String   @default("[]")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Session {
  id        Int      @id @default(autoincrement())
  userId    Int
  tokenHash String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
}

model Post {
  id              Int           @id @default(autoincrement())
  title           String
  slug            String        @unique
  excerpt         String?
  content         String
  status          PublishStatus @default(draft)
  featuredImageId Int?
  publishedAt     DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  featuredImage   Media?        @relation(fields: [featuredImageId], references: [id], onDelete: SetNull)
  categories      Category[]

  @@index([status])
  @@index([createdAt])
}

model Category {
  id          Int      @id @default(autoincrement())
  name        String
  slug        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  posts       Post[]

  @@index([createdAt])
}

model Page {
  id              Int           @id @default(autoincrement())
  title           String
  slug            String        @unique
  content         String
  status          PublishStatus @default(draft)
  featuredImageId Int?
  publishedAt     DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  featuredImage   Media?        @relation(fields: [featuredImageId], references: [id], onDelete: SetNull)

  @@index([status])
  @@index([createdAt])
}

model Media {
  id           Int      @id @default(autoincrement())
  filename     String
  originalName String
  title        String?
  caption      String?
  description  String?
  mimeType     String
  size         Int
  width        Int?
  height       Int?
  altText      String?
  path         String
  url          String
  createdAt    DateTime @default(now())
  posts        Post[]
  pages        Page[]

  @@index([createdAt])
}

model Setting {
  key       String   @id
  value     String
  updatedAt DateTime @updatedAt
}
